

# 0) Mental model you need

**Three layers to master**

1. **Repositories** tell your system where packages live. They are configured in `.repo` files and optionally via registration tools.
2. **Packages** are managed with `dnf` for transactions and `rpm` for low-level inspection.
3. **Flatpak** is a separate app distribution system with its own remotes and runtimes.

Keep SELinux Enforcing. Keep firewalld running. Use `sudo`. Verify every action.

---

# 1) RPM repositories

## A. What a repo looks like

Files in `/etc/yum.repos.d/*.repo` with sections like:

```
[appstream]
name=RHEL AppStream
baseurl=https://mirror.example/rhel/$releasever/AppStream/$basearch/os/
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
```

Key fields you must know:

* `baseurl` or `metalink` or `mirrorlist`
* `enabled=1|0`
* `gpgcheck=1` and a valid `gpgkey` URL
* Variables like `$releasever`, `$basearch` get expanded by dnf

## B. Inspect and toggle repos

```
dnf repolist
dnf repolist all
dnf makecache
dnf clean all
```

Enable or disable quickly:

```
sudo dnf config-manager --set-enabled <repoid>
sudo dnf config-manager --set-disabled <repoid>
```

Show the actual `.repo` files you are using:

```
grep -R . /etc/yum.repos.d/*.repo
```

## C. Registration when required

On RHEL systems that use subscription management:

```
subscription-manager status
subscription-manager repos --list
sudo subscription-manager repos --enable <repoid>
```

## D. Local ISO media repo

Classic exam move. Mount ISO. Point two repos at it.

```
sudo mkdir -p /mnt/rhel
sudo mount -o loop /path/to/rhel.iso /mnt/rhel
sudo tee /etc/yum.repos.d/local-media.repo >/dev/null <<'EOF'
[local-baseos]
name=Local BaseOS
baseurl=file:///mnt/rhel/BaseOS
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release

[local-appstream]
name=Local AppStream
baseurl=file:///mnt/rhel/AppStream
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
EOF
sudo rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
sudo dnf clean all && sudo dnf makecache
```

Strong opinion: do not set `sslverify=0` on real systems. On exams you should not need to either.

---

# 2) RPM package management

## A. Install, remove, search, info

```
dnf search <pattern>
dnf info <pkg>
sudo dnf install -y <pkg>
dnf list installed <pkg>
sudo dnf remove -y <pkg>
sudo dnf autoremove -y
```

Install a local file with dependencies solved:

```
sudo dnf install -y /path/to/file.rpm
```

## B. Who owns what path

```
dnf provides /usr/bin/ssh
dnf provides /etc/ssh/sshd_config
```

## C. Transactions and rollback

```
dnf history
dnf history info <ID>
sudo dnf history undo -y <ID>
```

## D. Low-level rpm for inspection

```
rpm -q <pkg>            # is it installed
rpm -qi <pkg>           # metadata
rpm -ql <pkg>           # files
rpm -qc <pkg>           # config files
rpm -qf /path/to/file   # what package owns this file
rpm -Va                 # verify all packages (expect config differences)
```

Practical advice: do installs and removals with `dnf`. Use `rpm` to inspect and verify.

---

# 3) Module streams

Some stacks ship multiple versions. You pick a **stream**, then install.

```
dnf module list
sudo dnf module enable -y <name>:<stream>
sudo dnf install -y @<name>:<stream>
sudo dnf module reset -y <name>
sudo dnf module disable -y <name>
```

If you switch streams, reset first, then enable the new stream. When in doubt, read `dnf`’s hints. They are usually right.

---

# 4) Flatpak repositories and apps

## A. Install tooling

```
sudo dnf install -y flatpak
flatpak --version
```

## B. Remotes

System-wide remotes affect all users. User remotes affect only the invoking user.

```
flatpak remotes
sudo flatpak remote-add --if-not-exists --system flathub https://flathub.org/repo/flathub.flatpakrepo
flatpak remotes --show-details
sudo flatpak remote-modify --disable flathub
sudo flatpak remote-modify --enable flathub
sudo flatpak remote-delete <remote>
```

## C. Apps

```
flatpak search <pattern>
sudo flatpak install -y --system flathub <appid>
flatpak list
flatpak info <appid>
flatpak run <appid>      # verify it launches
sudo flatpak uninstall -y <appid>
sudo flatpak uninstall -y --unused
```

Flatpak pulls **runtimes**. Cleaning `--unused` wins you points for tidiness.

---

# 5) Troubleshooting patterns

* **Cannot find packages**. Repo disabled or wrong baseurl. Check `dnf repolist all` and read `.repo` files.
* **GPG failures**. `gpgcheck=1` with a missing imported key. Import the right key, not any random one.
* **Module confusion**. You tried to install a module without an enabled stream. Reset, enable, try again.
* **Flatpak silent fail**. Remote disabled or appid typo. `flatpak remotes` and `flatpak search` to confirm.

Traditional wisdom: always read the exact error text. Modern habit: pipe to a log for proof.

---

# 6) Speed drills you should be able to do in 3 minutes

* Enable a disabled repo, install `tree`, show which package owns `/usr/bin/tree`, remove it, then `dnf history undo`.
* Enable `nodejs` a specific stream, install, show `node --version`, reset, enable another stream, switch.
* Add Flathub as a system remote, install `org.gnome.Calculator`, run it, uninstall, and clean `--unused`.

If you can do those calmly, you are in good shape.

---

# 7) Labs first, solutions after

Do these on your Red Hat box. Do not peek until you try.

## A. Repositories

**A1. Baseline.** List enabled and disabled repos, then build cache.
**A2. Toggle.** Enable one disabled repo, disable one enabled repo, prove both.
**A3. Local ISO repo.** Mount an RHEL ISO at `/mnt/rhel`, create `local-media.repo` for BaseOS and AppStream, import the GPG key, and make cache.
**A4. Add by URL.** Add a temporary URL repo with `dnf config-manager --add-repo`, show it exists, then disable it.
**A5. GPG hardening.** Ensure `gpgcheck=1`, show an install fails without the key, import the key, succeed.
**A6. Registration.** Show registration status, list repos, enable one via `subscription-manager`, and verify it appears in `dnf repolist`.
**A7. Modules inventory.** List module streams and show info for one module.

## B. RPM packages

**B1. Search and install.** Search for a simple editor, install it, show info and files it provides.
**B2. Remove and clean.** Remove it, run `autoremove`, and show the transaction history.
**B3. Local RPM.** Install an rpm from the filesystem with dependencies resolved. Verify a file’s owner with `rpm -qf`.
**B4. Provides.** Identify who provides `/usr/bin/ssh` and `/etc/ssh/sshd_config`.
**B5. Reinstall and verify.** Reinstall `coreutils` and verify with `rpm -V`, explaining config differences.
**B6. Undo.** Install two small packages, capture their transaction ID, and `history undo` it.
**B7. Cache habits.** `dnf clean all`, `dnf makecache`, then time a search before and after.

## C. Module streams

**C1. Enable and install.** Enable `nodejs:<stream>`, install the module group, and verify version.
**C2. Switch.** Reset the module, enable a different stream, switch correctly, and verify.
**C3. Disable fully.** Disable the module and confirm it is not available until reenabled.

## D. Flatpak repos

**D1. Tooling.** Install Flatpak and show the version.
**D2. Flathub remote.** Add flathub system-wide, list remotes, disable and reenable it.
**D3. Remove remote.** Add a second remote, delete it, prove it is gone.

## E. Flatpak apps

**E1. Install.** Search for a calculator app, install system-wide, list it, and run it.
**E2. Update and runtimes.** Check for updates and show app vs runtime lists.
**E3. Uninstall and clean.** Uninstall the app and remove unused runtimes. Confirm it is gone.

## F. Troubleshooting

**F1. Broken repo.** Introduce a safe typo in a `.repo` file, show the `dnf repolist` error, fix it, recheck.
**F2. GPG missing.** Force a GPG error and fix it properly.
**F3. Verify everything.** Run `rpm -Va`, count lines that indicate config changes, and explain what is noise vs signal.
**F4. Module hint.** Attempt to install a module package without enabling its stream, observe the hint, then enable and succeed.

## G. Speed runs

**G1. rpm drill.** Enable, install, prove owner, remove, undo.
**G2. module drill.** Enable stream, install, show version, reset, switch stream, show version.
**G3. flatpak drill.** Add remote, install app, run, uninstall, clean.

---

# SOLUTION KEY

## A. Repositories

**A1**

```bash
dnf repolist
dnf repolist all
dnf makecache
```

**A2**

```bash
sudo dnf repolist all | awk '/disabled/{print $1; exit}' | xargs -r sudo dnf config-manager --set-enabled
sudo dnf repolist | awk 'NR==3{print $1}' | xargs -r sudo dnf config-manager --set-disabled
dnf repolist all | head
```

**A3**

```bash
sudo mkdir -p /mnt/rhel
sudo mount -o loop /path/to/rhel.iso /mnt/rhel
sudo tee /etc/yum.repos.d/local-media.repo >/dev/null <<'EOF'
[local-baseos]
name=Local BaseOS
baseurl=file:///mnt/rhel/BaseOS
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
[local-appstream]
name=Local AppStream
baseurl=file:///mnt/rhel/AppStream
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
EOF
sudo rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
sudo dnf clean all && sudo dnf makecache
sudo dnf repoquery --repo local-baseos --available | head
```

**A4**

```bash
sudo dnf install -y dnf-plugins-core
sudo dnf config-manager --add-repo https://download.example.com/example.repo
dnf repolist | grep -i example || true
sudo dnf config-manager --set-disabled example
dnf repolist all | grep -i example || true
```

**A5**

```bash
sudo dnf clean metadata
sudo rpm -e --nodeps $(rpm -q gpg-pubkey --qf '%{name}-%{version}-%{release}\n' | head -n1) || true
sudo dnf install -y bash || echo "failed as expected"
sudo rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
sudo dnf install -y bash
```

**A6**

```bash
subscription-manager status || true
subscription-manager repos --list | head -n 30
sudo subscription-manager repos --enable <repoid>
dnf repolist | grep -F "<repoid>"
```

**A7**

```bash
dnf module list | head -n 40
dnf module info nodejs | sed -n '1,40p'
```

## B. RPM packages

**B1**

```bash
dnf search editor | head
sudo dnf install -y nano
dnf info nano
rpm -ql nano | head
```

**B2**

```bash
sudo dnf remove -y nano
sudo dnf autoremove -y
dnf history | head
```

**B3**

```bash
sudo dnf install -y /tmp/somepkg.rpm
rpm -qf /usr/bin/somebinary
```

**B4**

```bash
dnf provides /usr/bin/ssh
dnf provides /etc/ssh/sshd_config
```

**B5**

```bash
sudo dnf reinstall -y coreutils
rpm -V coreutils | tee /tmp/coreutils.verify || true
```

**B6**

```bash
sudo dnf install -y tree zip
dnf history | head
TX=$(dnf history | awk 'NR==3{print $1}')
sudo dnf history undo -y "$TX"
rpm -q tree zip || echo "both removed"
```

**B7**

```bash
sudo dnf clean all
/usr/bin/time -f '%E' dnf search nothing 2>/dev/null || true
sudo dnf makecache
/usr/bin/time -f '%E' dnf search bash >/dev/null
```

## C. Module streams

**C1**

```bash
dnf module list nodejs
sudo dnf module enable -y nodejs:18
sudo dnf install -y @nodejs:18
node --version 2>/dev/null || rpm -qa | grep -i node
```

**C2**

```bash
sudo dnf module reset -y nodejs
sudo dnf module enable -y nodejs:20
sudo dnf distro-sync -y
node --version 2>/dev/null || rpm -qa | grep -i node
```

**C3**

```bash
sudo dnf module disable -y nodejs
dnf module list nodejs | sed -n '1,20p'
```

## D. Flatpak repos

**D1**

```bash
sudo dnf install -y flatpak
flatpak --version
```

**D2**

```bash
sudo flatpak remote-add --if-not-exists --system flathub https://flathub.org/repo/flathub.flatpakrepo
flatpak remotes
sudo flatpak remote-modify --disable flathub
flatpak remotes --show-details | grep -A3 flathub
sudo flatpak remote-modify --enable flathub
```

**D3**

```bash
sudo flatpak remote-add --if-not-exists --system tempremote https://flathub.org/repo/flathub.flatpakrepo
flatpak remotes | grep tempremote
sudo flatpak remote-delete tempremote
flatpak remotes | grep tempremote || echo "removed"
```

## E. Flatpak apps

**E1**

```bash
flatpak search calculator | head
sudo flatpak install -y --system flathub org.gnome.Calculator
flatpak list | grep Calculator
flatpak run org.gnome.Calculator >/dev/null 2>&1 || true
```

**E2**

```bash
flatpak update -y
flatpak list --app
flatpak list --runtime
```

**E3**

```bash
sudo flatpak uninstall -y org.gnome.Calculator
sudo flatpak uninstall -y --unused
flatpak list | grep -i calculator || echo "clean"
```

## F. Troubleshooting

**F1**

```bash
sudo sed -i 's/^enabled=1/enabled=bogus/' /etc/yum.repos.d/local-media.repo
dnf repolist || echo "saw failure as expected"
sudo sed -i 's/^enabled=bogus/enabled=1/' /etc/yum.repos.d/local-media.repo
dnf repolist
```

**F2**

```bash
sudo rpm -e --nodeps $(rpm -q gpg-pubkey --qf '%{name}-%{version}-%{release}\n' | head -n1) || true
sudo dnf clean metadata
sudo dnf install -y bash || echo "gpg failure as expected"
sudo rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
sudo dnf install -y bash
```

**F3**

```bash
sudo rpm -Va > /tmp/rpm-verify.txt || true
grep -v '^$' /tmp/rpm-verify.txt | wc -l
grep ' /etc/.* c ' /tmp/rpm-verify.txt | head
```

**F4**

```bash
sudo dnf module reset -y postgresql || true
sudo dnf install -y postgresql || echo "dnf should hint about module enablement"
sudo dnf module enable -y postgresql:<valid_stream>
sudo dnf install -y postgresql
```

## G. Speed runs

**G1**

```bash
dnf repolist all | awk '/disabled/{print $1;exit}' | xargs -r sudo dnf config-manager --set-enabled
sudo dnf install -y tree
rpm -qf "$(command -v tree)"
sudo dnf remove -y tree
TX=$(dnf history | awk 'NR==3{print $1}')
sudo dnf history undo -y "$TX"
```

**G2**

```bash
sudo dnf module enable -y nodejs:18
sudo dnf install -y @nodejs:18
node --version 2>/dev/null || rpm -qa | grep -i node
sudo dnf module reset -y nodejs
sudo dnf module enable -y nodejs:20
sudo dnf distro-sync -y
node --version 2>/dev/null || rpm -qa | grep -i node
```

**G3**

```bash
sudo flatpak remote-add --if-not-exists --system flathub https://flathub.org/repo/flathub.flatpakrepo
sudo flatpak install -y --system flathub org.gnome.Calculator
flatpak run org.gnome.Calculator >/dev/null 2>&1 || true
sudo flatpak uninstall -y org.gnome.Calculator
sudo flatpak uninstall -y --unused
```

---

## One-page cheat sheet

* **Repos**
  `dnf repolist[ all]` • `dnf config-manager --set-enabled|--set-disabled <id>` • ISO repo with `file:///` • `rpm --import <key>`
* **Packages**
  `dnf search/info/install/remove/autoremove` • `dnf provides <path>` • `dnf history [undo]` • `rpm -ql|-qi|-qf|-Va`
* **Modules**
  `dnf module list` • `module enable <name>:<stream>` • `module reset` • `@<name>:<stream>` install
* **Flatpak**
  `flatpak remotes` • `remote-add --system flathub <url>` • `install --system <appid>` • `list` • `uninstall --unused`
* **Sanity checks**
  `dnf makecache` • read errors carefully • prove success with `rpm -q`, `dnf list installed`, and running the app where sensible
