
# 0) Ground rules and quick setup

* Work as a regular user. Use sudo when needed.
* Practice under `/tmp/rhcsa-tools`. Verify every step.

```bash
mkdir -p /tmp/rhcsa-tools && cd /tmp/rhcsa-tools
```

---

# 1) Access a shell and issue commands correctly

**Know what a command is**

```bash
type cd echo ls which cat            # builtin, function, alias, or file
command -V ls
```

**Paths, quoting, variables**

```bash
echo "$SHELL"                        # show current shell
NAME="Saria"; echo "hi $NAME"        # no spaces around =
echo 'literal $HOME'                 # single quotes prevent expansion
echo "home is $HOME"                 # double quotes expand
```

**Subshell vs current shell**

```bash
( cd / ; pwd ) ; pwd                 # left side does not affect right
```

**Exit codes and control operators**

```bash
false ; echo $?                      # nonzero means failure
mkdir ok && echo "made it"           # run next if success
false || echo "fallback"             # run next if failure
```

**Globbing and brace expansion**

```bash
touch file{1..3}.txt                 # file1.txt file2.txt file3.txt
ls *.txt
```

**Command substitution**

```bash
TODAY="$(date +%F)"; echo "$TODAY"
```

---

# 2) Input and output redirection

**STDIN 0, STDOUT 1, STDERR 2**

```bash
echo ok > out.log                    # overwrite
echo more >> out.log                 # append
cmd 1>stdout.log 2>stderr.log
cmd > all.log 2>&1                   # combine
```

**Pipes and tee**

```bash
dnf list | grep -i bash | tee pkgs.txt
```

**Here document and here string**

```bash
cat <<'EOF' > /etc/motd.sample
Welcome to the lab
EOF

grep root <<< "$(cat /etc/passwd)"
```

---

# 3) grep and regular expressions

**Daily bread**

```bash
grep root /etc/passwd
grep -nHri "sshd" /etc
```

**Extended regex and anchors**

```bash
grep -E '^(sshd|crond)\b' /etc/services
grep -E 'user[0-9]{2}'  users.txt
grep -E '^(ID|VERSION_ID)=' /etc/os-release
```

**Useful flags**
`-v` invert, `-o` only match, `-c` count, `-A/-B/-C` context, `-F` fixed string.

---

# 4) Access remote systems with SSH

**Basics**

```bash
ssh user@server
ssh -p 2222 user@server
```

**Keys**

```bash
ssh-keygen -t ed25519 -C "lab"
ssh-copy-id user@server
ssh -i ~/.ssh/id_ed25519 user@server
```

**Files**

```bash
scp file user@server:/tmp/
sftp user@server
```

Quality of life: `~/.ssh/config` supports Host aliases, Port, User, IdentityFile.

---

# 5) Log in and switch users in multiuser targets

**Targets**

```bash
systemctl get-default
sudo systemctl isolate multi-user.target
sudo systemctl set-default multi-user.target
```

**Users and sessions**

```bash
who; w; last -n 5; lastlog -t 7
su - alice
sudo -iu alice
```

---

# 6) Archive, compress, unpack, uncompress

**tar with gzip and bzip2**

```bash
tar -czf etc.tgz /etc            # create gzip
tar -tzf etc.tgz | head          # list
tar -xzf etc.tgz -C /tmp         # extract

tar -cjf logs.tbz /var/log       # create bzip2
tar -tjf logs.tbz | head
tar -xjf logs.tbz -C /tmp
```

**Standalone**

```bash
gzip file ; gunzip file.gz
bzip2 file ; bunzip2 file.bz2
```

**Exclude**

```bash
tar -czf home.tgz /home --exclude='*.mp4'
```

---

# 7) Create and edit text files

**Editors that always exist**

* `vi` or `vim` if present. Minimal vi you must know:
  `i` insert, `Esc`, `:wq` save and quit, `:q!` quit no save, `dd` delete line, `yy` yank, `p` paste, `/pattern` search
* `nano` often available.

**Quick without an editor**

```bash
printf "line1\n" > file.txt
```

**Safer root edits**

```bash
sudoedit /etc/whatever.conf
```

---

# 8) Create, delete, copy, move files and directories

```bash
mkdir -p project/{bin,conf,logs}
touch project/conf/app.conf
cp -r project /tmp/project.bak
cp -a project /tmp/project.preserve    # preserve perms, times, links
mv project/bin project/scripts
rm -r /tmp/project.bak
```

**Find or tree for verification**

```bash
find project -maxdepth 2 -printf '%M %u:%g %p\n'
```

---

# 9) Links: hard and soft

```bash
echo data > base
ln base hardlink
ln -s base symlink
ls -li base hardlink symlink          # inode numbers
readlink -f symlink                   # resolve
mv base base.orig
cat hardlink                          # works
cat symlink || echo "symlink broken"  # breaks
```

---

# 10) Permissions u g o and rwx

**View and change**

```bash
stat -c '%A %a %U:%G %n' file
chmod 640 file
chmod u+x script.sh
chown user:group file
chgrp group file
```

**Special bits and defaults**

```bash
chmod 2775 /srv/share       # setgid on dir so group is inherited
chmod 1777 /srv/drop        # sticky bit
umask                        # 022 or 027 common
umask 027                    # new files 640, dirs 750
```

---

# 11) System documentation

```bash
man <topic>
man -k keyword              # apropos
man 5 passwd                # section 5 file formats
info coreutils 'cp invocation'
rpm -qd <pkg>               # doc files for installed package
ls /usr/share/doc/<pkg>*    # browse docs
dnf provides /usr/bin/ls    # who owns a path
zless README.gz             # read compressed docs
```

---

# Labs first, solutions later

Do not peek. Work in `/tmp/rhcsa-tools`.

## A. Shell, syntax, redirection

1. Create `note1.txt` to `note5.txt` with one command.
2. Set `PROJECT=alpha` and print `Project alpha ready` using the variable.
3. Run `pwd` inside a subshell that `cd`s to `/` and prove your current shell did not move.
4. Run `date` writing STDOUT to `out.log` and STDERR to `err.log` in a single command.

## B. Pipes and here docs

5. Save stdout and stderr from `dnf info nopepackage` into `pkg.log`.
6. From `journalctl -u sshd`, count lines that contain `Accepted` or `Failed`.
7. Create `msg.txt` with a here doc containing exactly 3 lines.

## C. grep and regex

8. From `/etc/passwd`, print only usernames that start with `r` or `s`.
9. Count how many lines in `/etc/services` start with `http` or `https`.
10. From `/etc/os-release`, print only lines that start with `ID=` or `VERSION_ID=`.

## D. SSH and file transfer

11. Generate an ed25519 key and copy it to `user@serverB`.
12. Fetch `/etc/issue` from `serverB` into `/tmp/rhcsa-tools/issue.serverB` with scp.

## E. Targets and switching users

13. Show the current default target, switch to `multi-user.target` for now, then confirm.
14. Create a user `u01`, switch to it, and print the effective user and shell.

## F. Archive and compress

15. Create `/tmp/ssh.tgz` from `/etc/ssh` with gzip.
16. List its contents, then extract to `/tmp/ssh_extract`.
17. Create `/tmp/logs.tbz` from `/var/log` with bzip2.

## G. Editing and file ops

18. Create `app.conf` with vi containing `port=8080` then save.
19. Copy `app.conf` to `conf.d/app.conf` preserving mode and timestamps.
20. Move `conf.d` to `config`, then delete `config/app.conf`.

## H. Links

21. Create `data.txt`, then a hard link and a symlink to it. Rename the original. Prove which link breaks.
22. Show inode numbers for all three and confirm the hard link shares the inode.

## I. Permissions

23. Create `/srv/team` owned root\:dev with `2775`. Add your user to `dev`, create a file there, and prove the group is inherited.
24. Set `umask 027` then create `secret.txt`. Show the resulting mode is `640`.

## J. Documentation

25. Use `dnf provides` to find which package owns `/usr/bin/rsync`.
26. Open the man page that documents `/etc/fstab` format.
27. List the documentation files installed by `coreutils`.

---

## Solution key

### A. Shell, syntax, redirection

```bash
# 1
touch note{1..5}.txt
# 2
PROJECT=alpha; echo "Project $PROJECT ready"
# 3
( cd /; pwd ); pwd
# 4
date 1>out.log 2>err.log
```

### B. Pipes and here docs

```bash
# 5
dnf info nopepackage >pkg.log 2>&1 || echo "nonzero exit: $?"
# 6
journalctl -u sshd | grep -E "Accepted|Failed" -c
# 7
cat <<'EOF' > msg.txt
line one
line two
line three
EOF
```

### C. grep and regex

```bash
# 8
cut -d: -f1 /etc/passwd | grep -E '^[rs]'
# 9
grep -Ec '^(http|https)\b' /etc/services
# 10
grep -E '^(ID|VERSION_ID)=' /etc/os-release
```

### D. SSH and file transfer

```bash
# 11
ssh-keygen -t ed25519 -C "lab" -f ~/.ssh/id_ed25519
ssh-copy-id user@serverB
# 12
scp user@serverB:/etc/issue /tmp/rhcsa-tools/issue.serverB
```

### E. Targets and switching users

```bash
# 13
systemctl get-default
sudo systemctl isolate multi-user.target
# 14
sudo useradd -m u01
sudo -iu u01 bash -lc 'id -un; echo "$SHELL"'
```

### F. Archive and compress

```bash
# 15
sudo tar -czf /tmp/ssh.tgz /etc/ssh
# 16
tar -tzf /tmp/ssh.tgz | head
mkdir -p /tmp/ssh_extract
sudo tar -xzf /tmp/ssh.tgz -C /tmp/ssh_extract
# 17
sudo tar -cjf /tmp/logs.tbz /var/log
```

### G. Editing and file ops

```bash
# 18  (in vi) i, type port=8080, Esc, :wq
vi app.conf
# 19
mkdir -p conf.d
cp -a app.conf conf.d/
# 20
mv conf.d config
rm -f config/app.conf
```

### H. Links

```bash
# 21
echo data > data.txt
ln data.txt data.hard
ln -s data.txt data.sym
mv data.txt data.orig
cat data.hard
cat data.sym || echo "symlink broken"
# 22
ls -li data.orig data.hard data.sym
```

### I. Permissions

```bash
# 23
sudo groupadd -f dev
sudo install -d -m 2775 -o root -g dev /srv/team
sudo usermod -aG dev "$USER"
newgrp dev <<'EOF'
touch /srv/team/hello
ls -l /srv/team/hello
EOF
# 24
umask 027
touch secret.txt
stat -c '%a %n' secret.txt   # expect 640
```

### J. Documentation

```bash
# 25
dnf provides /usr/bin/rsync
# 26
man 5 fstab
# 27
rpm -qd coreutils | sed -n '1,40p'
ls /usr/share/doc/coreutils* 2>/dev/null
```

---

## One page cheat sheet

* **Shell**: `type cmd`, quotes `'` vs `"`, `$(cmd)`, `VAR=1`, `$?`, braces `{1..n}`
* **Redirection**: `>` overwrite, `>>` append, `2>` errors, `> all 2>&1`, `tee`
* **grep**: `-nHri`, `-E` extended, anchors `^ $`, counts `-c`, invert `-v`
* **SSH**: `ssh user@host`, `ssh-keygen -t ed25519`, `ssh-copy-id`, `scp a b:~/`
* **Targets**: `systemctl isolate multi-user.target`, `set-default multi-user.target`
* **Archive**: `tar -czf a.tgz dir`, `-xzf a.tgz -C dest`, `-cjf a.tbz dir`
* **Edit**: vi basics `i`, `Esc`, `:wq`, `:q!`; `sudoedit` for root files
* **Files**: `cp -a`, `mv`, `rm -r`, `find`
* **Links**: `ln file hard`, `ln -s file sym`, `ls -li`, `readlink -f`
* **Perms**: `chmod 640`, `chown u:g`, setgid `chmod 2775 dir`, sticky `chmod 1777 dir`, `umask 027`
* **Docs**: `man`, `man -k`, `man 5 <filefmt>`, `rpm -qd pkg`, `/usr/share/doc/*`, `dnf provides PATH`

