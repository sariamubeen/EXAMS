
# 0) Mental model you actually need

* **Schedulers:** one-time jobs with `at`; recurring jobs with `cron` (and anacron for catch-up).
* **Services:** systemd is the boss. Start/stop/reload now; enable/disable for boot.
* **Boot targets:** sets of services. `multi-user.target` (CLI) and `graphical.target` (GUI) are the big two.
* **Time:** `chronyd` syncs system time; `timedatectl` shows status.
* **Software:** `dnf` for transactions; repos from RH CDN, mirrors, or local media; `rpm` for low-level inspection.
* **Bootloader:** GRUB2. Add kernel args, switch default kernels, rebuild config safely.

Bias: use absolute paths, verify every change, and always have a rollback.

---

# 1) Schedule tasks using **at** and **cron**

## at (one-time)

```bash
sudo systemctl enable --now atd           # make sure it’s running
at 14:30                                   # or 'at now + 10 minutes'
# type commands, each on its own line:
touch /tmp/at_test
<Ctrl+D>
atq                                        # list queued jobs
atrm <jobID>                               # remove
```

Time formats that just work: `now + 5 min`, `tomorrow 01:00`, `08:00 09/02/2025`. Redirect output explicitly:

```bash
at now + 2 min <<'EOF'
/usr/bin/echo "hello" >> /tmp/hello.log 2>&1
EOF
```

## cron (recurring)

User crontab:

```bash
crontab -e
# Example: minute hour day month weekday
# Run backup every day at 01:30, log output:
30 1 * * * /usr/local/sbin/backup.sh >>/var/log/backup.log 2>&1
crontab -l
```

System crontab and cron.d:

* `/etc/crontab` and files in `/etc/cron.d/` use an extra **user** field:

  ```
  0 * * * *  root  /usr/local/sbin/hourly-job.sh
  ```
* Drop simple scripts in `/etc/cron.daily/`, `/etc/cron.weekly/` and ensure they’re executable.

Quality rules for the exam:

* Use full paths to commands and files.
* Always capture stdout/stderr.
* Keep `crond` running:

  ```bash
  sudo systemctl enable --now crond
  journalctl -u crond -n 50 --no-pager
  ```

---

# 2) Start/stop services and enable at boot (systemd)

Common flows:

```bash
sudo systemctl start httpd
sudo systemctl stop httpd
sudo systemctl restart httpd
sudo systemctl reload httpd
systemctl status httpd --no-pager
```

Enable/disable:

```bash
sudo systemctl enable --now sshd
sudo systemctl disable --now telnet.socket
systemctl is-enabled sshd
```

Prevent any start (even manual):

```bash
sudo systemctl mask telnet.socket
sudo systemctl unmask telnet.socket
```

Verification habits:

```bash
ss -lntp | grep -E ':(22|80)\b'
journalctl -u httpd -b --no-pager
```

---

# 3) Configure systems to boot into a specific target

Now (temporarily):

```bash
sudo systemctl isolate multi-user.target
sudo systemctl isolate graphical.target
```

Default for future boots:

```bash
systemctl get-default
sudo systemctl set-default multi-user.target
sudo systemctl set-default graphical.target
```

One-time from GRUB (no lasting change): at the GRUB menu press **e**, append
`systemd.unit=rescue.target` to the kernel line, then **Ctrl+x** to boot.

---

# 4) Configure time service clients (chrony)

Install and enable:

```bash
sudo dnf -y install chrony
sudo systemctl enable --now chronyd
```

Point to your NTP servers (client side):

```bash
sudoedit /etc/chrony.conf
# replace or add lines like:
# pool time.example.com iburst
# or: server ntp1.example.com iburst
sudo systemctl restart chronyd
```

Verify and correct:

```bash
chronyc sources -v
chronyc tracking
timedatectl                       # shows NTP sync and timezone
sudo chronyc makestep             # force immediate correction if needed
```

Timezone is separate from NTP:

```bash
timedatectl list-timezones | grep -i karachi
sudo timedatectl set-timezone Asia/Karachi
```

---

# 5) Install and update software (RH CDN, remote repo, local files)

## A) Red Hat CDN (registered systems)

```bash
sudo subscription-manager status
sudo subscription-manager register --username <RHN_USER> --password '<PW>'
sudo subscription-manager attach --auto
sudo subscription-manager repos --list
sudo subscription-manager repos --enable rhel-*-baseos-rpms
sudo subscription-manager repos --enable rhel-*-appstream-rpms
```

Then use `dnf`:

```bash
sudo dnf makecache
sudo dnf install -y tree
sudo dnf update -y
```

## B) Remote repository (non-RH mirrors or internal)

```bash
sudo dnf -y install dnf-plugins-core
sudo dnf config-manager --add-repo https://mirror.example.com/custom.repo
dnf repolist
sudo dnf config-manager --set-enabled custom
```

## C) Local file system (ISO or RPM files)

**ISO repo** (classic exam move):

```bash
sudo mkdir -p /mnt/rhel
sudo mount -o loop /path/to/rhel.iso /mnt/rhel
sudo tee /etc/yum.repos.d/local-media.repo >/dev/null <<'EOF'
[local-baseos]
name=Local BaseOS
baseurl=file:///mnt/rhel/BaseOS
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
[local-appstream]
name=Local AppStream
baseurl=file:///mnt/rhel/AppStream
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
EOF
sudo rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
sudo dnf clean all && sudo dnf makecache
```

**Local RPM file with deps solved by dnf**:

```bash
sudo dnf install -y /tmp/somepkg.rpm
rpm -q somepkg
```

Low-level inspection:

```bash
rpm -qi tree
rpm -ql tree | head
dnf history
sudo dnf history undo <ID>
```

---

# 6) Modify the system bootloader (GRUB2)

## Kernel command-line arguments (safe patterns)

**Temporary** for one boot: press **e** at GRUB, append to the `linux` line (e.g., `ipv6.disable=1`), **Ctrl+x**.

**Persistent** with `grubby` (preferred):

```bash
grubby --default-kernel              # see which kernel is default
grubby --info=ALL | head
sudo grubby --update-kernel=DEFAULT --args="ipv6.disable=1 audit=0"
# Remove later:
sudo grubby --update-kernel=DEFAULT --remove-args="ipv6.disable=1 audit=0"
```

Or via `/etc/default/grub` then regenerate config:

* **BIOS** systems:

  ```bash
  sudoedit /etc/default/grub
  # GRUB_CMDLINE_LINUX="... ipv6.disable=1 ..."
  sudo grub2-mkconfig -o /boot/grub2/grub.cfg
  ```
* **UEFI** systems:

  ```bash
  sudo grub2-mkconfig -o /boot/efi/EFI/redhat/grub.cfg
  ```

Switch default kernel (e.g., older one after a bad update):

```bash
grubby --info=ALL | awk -F= '/kernel=/{print $2}'
sudo grubby --set-default /boot/vmlinuz-<version>
```

Verify after reboot:

```bash
cat /proc/cmdline
uname -r
grub2-editenv list
```

---

## Pitfalls that eat points

* Cron jobs failing because `$PATH` is tiny. Use absolute paths and redirect output.
* Confusing “start now” with “enable at boot.” Use both when needed: `enable --now`.
* Mixing runtime vs permanent repo or firewall changes. Know when a reload is required.
* Editing GRUB but forgetting to rebuild its config on BIOS/UEFI systems.
* Chrony “looks fine” but not actually syncing. Always `chronyc tracking` to confirm.

Tiny humor break: cron is like the post office. It always delivers on time… if you wrote the address correctly.

---

# Labs first, solutions after

Do these on your RHEL box. Don’t peek until you try.

## A. at & cron

1. Queue a one-time job to append the date to `/tmp/once.log` at “now + 3 minutes”. Confirm it appears in `atq`.
2. Create a cron job for root that runs `/usr/bin/true` every 5 minutes and logs to `/var/log/cron_true.log`.
3. Create `/etc/cron.d/cleanup` that deletes files older than 30 days in `/var/tmp/appcache` hourly.

## B. Services

4. Install `httpd`, start it, enable it at boot, and verify port 80 is listening.
5. Mask `telnet.socket`, show the effect, then unmask.

## C. Targets

6. Set `multi-user.target` as the default, then temporarily switch to `graphical.target` without changing the default.
7. Boot once into `rescue.target` from GRUB (no persistent change).

## D. Time service

8. Configure `chronyd` to use `time.example.com` with `iburst`. Restart chronyd and show synced status.
9. Set timezone to `Asia/Karachi` and verify.

## E. Software sources & installs

10. Mount a RHEL ISO at `/mnt/rhel` and create a local `.repo` for BaseOS and AppStream. Build cache and install `nano`.
11. Add a remote repo with `dnf config-manager --add-repo` (use any reachable test URL). Disable it again.
12. Install a local RPM file with `dnf install /path/to/pkg.rpm` and show which files it provided. Undo the transaction.

## F. Bootloader

13. Add `ipv6.disable=1` to the default kernel with `grubby`. Reboot and prove the arg is in effect.
14. Change the default kernel to the previous one. Reboot and verify `uname -r`.

---

# Solution key

## A. at & cron

```bash
# 1
sudo systemctl enable --now atd
at now + 3 minutes <<'EOF'
/usr/bin/date >> /tmp/once.log 2>&1
EOF
atq

# 2 (root’s crontab)
sudo bash -lc 'crontab -l 2>/dev/null; echo "*/5 * * * * /usr/bin/true >>/var/log/cron_true.log 2>&1"' | sudo crontab -
sudo systemctl enable --now crond
journalctl -u crond -n 20 --no-pager

# 3 /etc/cron.d/cleanup
echo '0 * * * * root /usr/bin/find /var/tmp/appcache -type f -mtime +30 -delete' | sudo tee /etc/cron.d/cleanup
sudo chmod 644 /etc/cron.d/cleanup
sudo systemctl reload crond
```

## B. Services

```bash
# 4
sudo dnf -y install httpd
sudo systemctl enable --now httpd
systemctl status httpd --no-pager
ss -lntp | grep ':80 '
# optional verify content
curl -I http://127.0.0.1 2>/dev/null | head -n1

# 5
sudo systemctl mask telnet.socket
sudo systemctl start telnet.socket || echo "masked, cannot start"
sudo systemctl unmask telnet.socket
```

## C. Targets

```bash
# 6
sudo systemctl set-default multi-user.target
sudo systemctl isolate graphical.target
systemctl get-default    # still multi-user.target

# 7 (do at GRUB screen)
# press e, append: systemd.unit=rescue.target, Ctrl+x to boot
```

## D. Time service

```bash
# 8
sudo dnf -y install chrony
sudo sed -i 's/^pool .*/pool time.example.com iburst/' /etc/chrony.conf
sudo systemctl enable --now chronyd
chronyc sources -v
chronyc tracking

# 9
sudo timedatectl set-timezone Asia/Karachi
timedatectl
```

## E. Software sources & installs

```bash
# 10 ISO repo
sudo mkdir -p /mnt/rhel
sudo mount -o loop /path/to/rhel.iso /mnt/rhel
sudo tee /etc/yum.repos.d/local-media.repo >/dev/null <<'EOF'
[local-baseos]
name=Local BaseOS
baseurl=file:///mnt/rhel/BaseOS
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
[local-appstream]
name=Local AppStream
baseurl=file:///mnt/rhel/AppStream
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
EOF
sudo rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
sudo dnf clean all && sudo dnf makecache
sudo dnf -y install nano
rpm -q nano

# 11 remote repo add/remove
sudo dnf -y install dnf-plugins-core
sudo dnf config-manager --add-repo https://download.example.com/example.repo
dnf repolist | grep -i example || true
sudo dnf config-manager --set-disabled example

# 12 local rpm and undo
sudo dnf -y install /tmp/mypkg.rpm
rpm -ql mypkg | head
TX=$(dnf history | awk 'NR==3{print $1}')
sudo dnf history undo -y "$TX"
```

## F. Bootloader

```bash
# 13 add kernel args
grubby --default-kernel
sudo grubby --update-kernel=DEFAULT --args="ipv6.disable=1"
sudo systemctl reboot

# after reboot
cat /proc/cmdline | grep -q 'ipv6.disable=1' && echo "OK"

# 14 set previous kernel as default
grubby --info=ALL | awk -F= '/kernel=/{print $2}'
# pick the previous /boot/vmlinuz-<ver>
sudo grubby --set-default /boot/vmlinuz-<previous-version>
sudo systemctl reboot
uname -r
```

---

## One-page cheat sheet

* **at**: `systemctl enable --now atd`; `at now + 10 min`; `atq`; `atrm ID`
* **cron**: `crontab -e`; `*/5 * * * * /path/cmd >>/path/log 2>&1`; system-wide `/etc/cron.d/*` include user field
* **services**: `systemctl start|stop|restart|reload name`; `enable --now`; `status`; `mask`
* **targets**: `set-default multi-user.target`; `isolate graphical.target`; GRUB one-time `systemd.unit=rescue.target`
* **time**: `chronyd` on; `/etc/chrony.conf` use `server/pool ... iburst`; verify `chronyc sources|tracking`; `timedatectl set-timezone`
* **software**: `subscription-manager ...`; `dnf install/update`; local ISO repo via `file:///` and imported GPG key; local `.rpm` with `dnf install ./pkg.rpm`; rollback `dnf history undo`
* **bootloader**: `grubby --update-kernel=DEFAULT --args="..."`; BIOS mkconfig `-o /boot/grub2/grub.cfg`; UEFI mkconfig `-o /boot/efi/EFI/redhat/grub.cfg`; verify `cat /proc/cmdline`
